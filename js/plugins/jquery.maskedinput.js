!function(e){var t,n,a=((n=document.createElement("input")).setAttribute("onpaste",""),("function"==typeof n.onpaste?"paste":"input")+".mask"),r=navigator.userAgent,i=/iphone/i.test(r),o=/android/i.test(r);e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},e.fn.extend({caret:function(e,t){var n;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each((function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&((n=this.createTextRange()).collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())}))):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(n,r){var c,l,s,u,f;return!n&&this.length>0?e(this[0]).data(e.mask.dataName)():(r=e.extend({placeholder:e.mask.placeholder,completed:null},r),c=e.mask.definitions,l=[],s=f=n.length,u=null,e.each(n.split(""),(function(e,t){"?"==t?(f--,s=e):c[t]?(l.push(new RegExp(c[t])),null===u&&(u=l.length-1)):l.push(null)})),this.trigger("unmask").each((function(){var h=e(this),d=e.map(n.split(""),(function(e,t){if("?"!=e)return c[e]?r.placeholder:e})),m=h.val();function p(e){for(;++e<f&&!l[e];);return e}function g(e,t){var n,a;if(!(e<0)){for(n=e,a=p(t);n<f;n++)if(l[n]){if(!(a<f&&l[n].test(d[a])))break;d[n]=d[a],d[a]=r.placeholder,a=p(a)}k(),h.caret(Math.max(u,e))}}function v(e,t){var n;for(n=e;n<t&&n<f;n++)l[n]&&(d[n]=r.placeholder)}function k(){h.val(d.join(""))}function b(e){var t,n,a=h.val(),i=-1;for(t=0,pos=0;t<f;t++)if(l[t]){for(d[t]=r.placeholder;pos++<a.length;)if(n=a.charAt(pos-1),l[t].test(n)){d[t]=n,i=t;break}if(pos>a.length)break}else d[t]===a.charAt(pos)&&t!==s&&(pos++,i=t);return e?k():i+1<s?(h.val(""),v(0,f)):(k(),h.val(h.val().substring(0,i+1))),s?t:u}h.data(e.mask.dataName,(function(){return e.map(d,(function(e,t){return l[t]&&e!=r.placeholder?e:null})).join("")})),h.attr("readonly")||h.one("unmask",(function(){h.unbind(".mask").removeData(e.mask.dataName)})).bind("focus.mask",(function(){var e;clearTimeout(t),m=h.val(),e=b(),t=setTimeout((function(){k(),e==n.length?h.caret(0,e):h.caret(e)}),10)})).bind("blur.mask",(function(){b(),h.val()!=m&&h.change()})).bind("keydown.mask",(function(e){var t,n,a,r=e.which;8===r||46===r||i&&127===r?(n=(t=h.caret()).begin,(a=t.end)-n==0&&(n=46!==r?function(e){for(;--e>=0&&!l[e];);return e}(n):a=p(n-1),a=46===r?p(a):a),v(n,a),g(n,a-1),e.preventDefault()):27==r&&(h.val(m),h.caret(0,b()),e.preventDefault())})).bind("keypress.mask",(function(t){var n,a,i,c=t.which,s=h.caret();t.ctrlKey||t.altKey||t.metaKey||c<32||c&&(s.end-s.begin!=0&&(v(s.begin,s.end),g(s.begin,s.end-1)),(n=p(s.begin-1))<f&&(a=String.fromCharCode(c),l[n].test(a)&&(function(e){var t,n,a,i;for(t=e,n=r.placeholder;t<f;t++)if(l[t]){if(a=p(t),i=d[t],d[t]=n,!(a<f&&l[a].test(i)))break;n=i}}(n),d[n]=a,k(),i=p(n),o?setTimeout(e.proxy(e.fn.caret,h,i),0):h.caret(i),r.completed&&i>=f&&r.completed.call(h))),t.preventDefault())})).bind(a,(function(){setTimeout((function(){var e=b(!0);h.caret(e),r.completed&&e==h.val().length&&r.completed.call(h)}),0)})),b()})))}})}(jQuery);